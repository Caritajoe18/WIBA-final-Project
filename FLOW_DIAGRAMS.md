# DropIt Registration System - Flow Diagrams

## 1. Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER REGISTRATION JOURNEY                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START
  â”‚
  â”œâ”€â–º Visit /register
  â”‚     â”‚
  â”‚     â”œâ”€â–º Fill Form (email, password, name, role)
  â”‚     â”‚
  â”‚     â”œâ”€â–º Submit Form
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º POST /api/auth/register
  â”‚     â”‚           â”‚
  â”‚     â”‚           â”œâ”€â–º Validate Input
  â”‚     â”‚           â”œâ”€â–º Check Duplicate Email
  â”‚     â”‚           â”œâ”€â–º Hash Password (bcrypt)
  â”‚     â”‚           â”œâ”€â–º Generate Verification Token
  â”‚     â”‚           â”œâ”€â–º Save User to Database
  â”‚     â”‚           â””â”€â–º Send Verification Email
  â”‚     â”‚
  â”‚     â””â”€â–º Show "Check Your Email" Message
  â”‚
  â”œâ”€â–º Check Email Inbox
  â”‚     â”‚
  â”‚     â””â”€â–º Click Verification Link
  â”‚           â”‚
  â”‚           â””â”€â–º Redirect to /verify-email?token=xxx
  â”‚                 â”‚
  â”‚                 â””â”€â–º POST /api/auth/verify-email
  â”‚                       â”‚
  â”‚                       â”œâ”€â–º Validate Token
  â”‚                       â”œâ”€â–º Check Expiration
  â”‚                       â”œâ”€â–º Mark Email as Verified
  â”‚                       â”œâ”€â–º Generate JWT Token
  â”‚                       â””â”€â–º Send Welcome Email
  â”‚
  â”œâ”€â–º Auto-Login (JWT stored)
  â”‚
  â”œâ”€â–º Redirect to /dashboard
  â”‚     â”‚
  â”‚     â”œâ”€â–º Display Profile Info
  â”‚     â”‚
  â”‚     â””â”€â–º Show "Connect Wallet" Option
  â”‚           â”‚
  â”‚           â”œâ”€â–º Click "Connect Wallet"
  â”‚           â”‚     â”‚
  â”‚           â”‚     â”œâ”€â–º Select Wallet Provider
  â”‚           â”‚     â”‚     â”œâ”€â–º MetaMask
  â”‚           â”‚     â”‚     â”œâ”€â–º WalletConnect
  â”‚           â”‚     â”‚     â””â”€â–º Coinbase Wallet
  â”‚           â”‚     â”‚
  â”‚           â”‚     â”œâ”€â–º Approve in Wallet
  â”‚           â”‚     â”‚
  â”‚           â”‚     â””â”€â–º POST /api/auth/connect-wallet
  â”‚           â”‚           â”‚
  â”‚           â”‚           â”œâ”€â–º Validate JWT
  â”‚           â”‚           â”œâ”€â–º Check Duplicate Wallet
  â”‚           â”‚           â”œâ”€â–º Link Wallet to User
  â”‚           â”‚           â””â”€â–º Return Success
  â”‚           â”‚
  â”‚           â””â”€â–º Show Connected Wallet
  â”‚
  â””â”€â–º READY TO USE DROPIT
        â”‚
        â”œâ”€â–º Create Tasks (if REQUESTER)
        â”œâ”€â–º Accept Tasks (if TASKER)
        â””â”€â–º Complete KYC (next phase)
```

## 2. Registration Flow (Detailed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Visit /register
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Registration Form Component      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Email                        â”‚  â”‚
â”‚  â”‚ â€¢ Password                     â”‚  â”‚
â”‚  â”‚ â€¢ Confirm Password             â”‚  â”‚
â”‚  â”‚ â€¢ First Name                   â”‚  â”‚
â”‚  â”‚ â€¢ Last Name                    â”‚  â”‚
â”‚  â”‚ â€¢ Phone (optional)             â”‚  â”‚
â”‚  â”‚ â€¢ Role (REQUESTER/TASKER)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           [Create Account]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 2. Form Validation (Zod)
               â”‚    âœ“ Email format
               â”‚    âœ“ Password length (min 8)
               â”‚    âœ“ Passwords match
               â”‚    âœ“ Required fields
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Client (api.ts)          â”‚
â”‚  POST /api/auth/register             â”‚
â”‚  {                                   â”‚
â”‚    email, password, firstName,       â”‚
â”‚    lastName, phoneNumber, role       â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 3. HTTP Request
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Backend: authController.ts        â”‚
â”‚                                      â”‚
â”‚  register() {                        â”‚
â”‚    1. Validate input                 â”‚
â”‚    2. Check existing user            â”‚
â”‚    3. Hash password (bcrypt)         â”‚
â”‚    4. Generate token (32 bytes)      â”‚
â”‚    5. Create user record             â”‚
â”‚    6. Send verification email        â”‚
â”‚    7. Return success                 â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â–º 4. Save to Database
               â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   â”‚  Supabase (Users)  â”‚
               â”‚   â”‚  â€¢ id (UUID)       â”‚
               â”‚   â”‚  â€¢ email           â”‚
               â”‚   â”‚  â€¢ password (hash) â”‚
               â”‚   â”‚  â€¢ role            â”‚
               â”‚   â”‚  â€¢ token           â”‚
               â”‚   â”‚  â€¢ expires         â”‚
               â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â””â”€â–º 5. Send Email
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Email Service     â”‚
                   â”‚  (Nodemailer)      â”‚
                   â”‚                    â”‚
                   â”‚  To: user@email    â”‚
                   â”‚  Subject: Verify   â”‚
                   â”‚  Link: /verify?... â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. Email Verification Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Email  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Receive Email
       â”‚    "Verify Your Email - DropIt"
       â”‚
       â”‚ 2. Click Verification Link
       â”‚    http://localhost:5173/verify-email?token=abc123...
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VerifyEmail.tsx Component          â”‚
â”‚                                      â”‚
â”‚  useEffect(() => {                   â”‚
â”‚    const token = searchParams.get()  â”‚
â”‚    verifyEmail(token)                â”‚
â”‚  })                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 3. Extract Token from URL
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Client (api.ts)          â”‚
â”‚  POST /api/auth/verify-email         â”‚
â”‚  { token: "abc123..." }              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 4. HTTP Request
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Backend: authController.ts        â”‚
â”‚                                      â”‚
â”‚  verifyEmail() {                     â”‚
â”‚    1. Find user by token             â”‚
â”‚    2. Check token exists             â”‚
â”‚    3. Check not expired              â”‚
â”‚    4. Mark email verified            â”‚
â”‚    5. Clear token                    â”‚
â”‚    6. Generate JWT                   â”‚
â”‚    7. Send welcome email             â”‚
â”‚    8. Return JWT + user              â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â–º 5. Update Database
               â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   â”‚  Users Table       â”‚
               â”‚   â”‚  isEmailVerified   â”‚
               â”‚   â”‚  = true            â”‚
               â”‚   â”‚  token = null      â”‚
               â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â””â”€â–º 6. Return JWT Token
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  JWT Token         â”‚
                   â”‚  {                 â”‚
                   â”‚    userId,         â”‚
                   â”‚    email,          â”‚
                   â”‚    role            â”‚
                   â”‚  }                 â”‚
                   â”‚  expires: 7 days   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Visit /login
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Login Form Component           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Email: [____________]          â”‚  â”‚
â”‚  â”‚ Password: [____________]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           [Login]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 2. Submit Credentials
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Client (api.ts)          â”‚
â”‚  POST /api/auth/login                â”‚
â”‚  { email, password }                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 3. HTTP Request
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Backend: authController.ts        â”‚
â”‚                                      â”‚
â”‚  login() {                           â”‚
â”‚    1. Find user by email             â”‚
â”‚    2. Check user exists              â”‚
â”‚    3. Compare password (bcrypt)      â”‚
â”‚    4. Check email verified           â”‚
â”‚    5. Generate JWT token             â”‚
â”‚    6. Return token + user            â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 4. Validate Credentials
               â”‚
               â”œâ”€â–º âœ“ User Found
               â”œâ”€â–º âœ“ Password Correct
               â”œâ”€â–º âœ“ Email Verified
               â”‚
               â”‚ 5. Generate JWT
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         JWT Token Created            â”‚
â”‚  {                                   â”‚
â”‚    userId: "uuid",                   â”‚
â”‚    email: "user@email.com",          â”‚
â”‚    role: "REQUESTER"                 â”‚
â”‚  }                                   â”‚
â”‚  Signed with JWT_SECRET              â”‚
â”‚  Expires in 7 days                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 6. Return to Frontend
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Frontend Receives Token        â”‚
â”‚  1. Store in localStorage            â”‚
â”‚  2. Set in API client                â”‚
â”‚  3. Redirect to /dashboard           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Wallet Connection Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Click "Connect Wallet"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WalletConnect Component (Wagmi)    â”‚
â”‚                                      â”‚
â”‚  Select Provider:                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [MetaMask]                     â”‚  â”‚
â”‚  â”‚ [WalletConnect]                â”‚  â”‚
â”‚  â”‚ [Coinbase Wallet]              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 2. User Selects MetaMask
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MetaMask Extension Popup        â”‚
â”‚                                      â”‚
â”‚  Connect to DropIt?                  â”‚
â”‚                                      â”‚
â”‚  Account: 0x1234...5678              â”‚
â”‚  Network: Base                       â”‚
â”‚                                      â”‚
â”‚  [Cancel]  [Connect]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 3. User Approves
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Wagmi Hook (useAccount)      â”‚
â”‚  {                                   â”‚
â”‚    address: "0x1234...5678",         â”‚
â”‚    isConnected: true,                â”‚
â”‚    chain: base                       â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 4. Get Wallet Address
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Client (api.ts)          â”‚
â”‚  POST /api/auth/connect-wallet       â”‚
â”‚  Headers: {                          â”‚
â”‚    Authorization: "Bearer <JWT>"     â”‚
â”‚  }                                   â”‚
â”‚  Body: {                             â”‚
â”‚    walletAddress: "0x1234...5678"    â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 5. HTTP Request with JWT
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Backend: authController.ts        â”‚
â”‚                                      â”‚
â”‚  connectWallet() {                   â”‚
â”‚    1. Verify JWT token               â”‚
â”‚    2. Get user from token            â”‚
â”‚    3. Check wallet not used          â”‚
â”‚    4. Link wallet to user            â”‚
â”‚    5. Save to database               â”‚
â”‚    6. Return success                 â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 6. Update Database
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Users Table Updated          â”‚
â”‚  {                                   â”‚
â”‚    id: "user-uuid",                  â”‚
â”‚    email: "user@email.com",          â”‚
â”‚    walletAddress: "0x1234...5678",   â”‚
â”‚    ...                               â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 7. Return Success
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Dashboard Shows Connected       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ“ Wallet Connected             â”‚  â”‚
â”‚  â”‚   0x1234...5678                â”‚  â”‚
â”‚  â”‚   [Disconnect]                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. Authentication Middleware Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Request to Protected Endpoint
       â”‚ GET /api/auth/profile
       â”‚ Headers: {
       â”‚   Authorization: "Bearer eyJhbGc..."
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Express Middleware Chain          â”‚
â”‚                                      â”‚
â”‚  1. CORS Middleware                  â”‚
â”‚     â”œâ”€â–º Check origin                â”‚
â”‚     â””â”€â–º Add CORS headers             â”‚
â”‚                                      â”‚
â”‚  2. Body Parser                      â”‚
â”‚     â””â”€â–º Parse JSON body              â”‚
â”‚                                      â”‚
â”‚  3. Auth Middleware (auth.ts)        â”‚
â”‚     â”œâ”€â–º Extract token                â”‚
â”‚     â”œâ”€â–º Verify JWT signature         â”‚
â”‚     â”œâ”€â–º Check expiration             â”‚
â”‚     â”œâ”€â–º Decode payload               â”‚
â”‚     â””â”€â–º Attach user to request       â”‚
â”‚                                      â”‚
â”‚  4. Route Handler                    â”‚
â”‚     â””â”€â–º Execute controller           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ If Token Valid
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Request Object Enhanced         â”‚
â”‚  req.user = {                        â”‚
â”‚    userId: "uuid",                   â”‚
â”‚    email: "user@email.com",          â”‚
â”‚    role: "REQUESTER"                 â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Continue to Controller
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Controller Executes             â”‚
â”‚  getProfile(req, res) {              â”‚
â”‚    const userId = req.user.userId    â”‚
â”‚    const user = await User.findByPk()â”‚
â”‚    res.json({ user })                â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

               â”‚ If Token Invalid
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Return 401 Unauthorized         â”‚
â”‚  {                                   â”‚
â”‚    error: "Invalid or expired token" â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. Data Flow Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA FLOW OVERVIEW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend                Backend              Database
   â”‚                       â”‚                     â”‚
   â”‚  1. Register          â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
   â”‚                       â”‚  2. Save User       â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  3. Success           â”‚                     â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                       â”‚                     â”‚
   â”‚  4. Verify Email      â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
   â”‚                       â”‚  5. Update User     â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  6. JWT Token         â”‚                     â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                       â”‚                     â”‚
   â”‚  7. Get Profile       â”‚                     â”‚
   â”‚  (with JWT)           â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
   â”‚                       â”‚  8. Query User      â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  9. User Data         â”‚                     â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                       â”‚                     â”‚
   â”‚  10. Connect Wallet   â”‚                     â”‚
   â”‚  (with JWT)           â”‚                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
   â”‚                       â”‚  11. Update Wallet  â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  12. Success          â”‚                     â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
   â”‚                       â”‚                     â”‚
```

## 8. Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ERROR HANDLING FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Action
    â”‚
    â”œâ”€â–º Frontend Validation (Zod)
    â”‚     â”‚
    â”‚     â”œâ”€â–º âœ“ Valid â†’ Continue
    â”‚     â”‚
    â”‚     â””â”€â–º âœ— Invalid â†’ Show Error
    â”‚           â””â”€â–º Display field errors
    â”‚               â””â”€â–º User corrects input
    â”‚
    â”œâ”€â–º API Request
    â”‚     â”‚
    â”‚     â”œâ”€â–º Network Error
    â”‚     â”‚     â””â”€â–º Show "Connection failed"
    â”‚     â”‚         â””â”€â–º Retry option
    â”‚     â”‚
    â”‚     â””â”€â–º Server Response
    â”‚           â”‚
    â”‚           â”œâ”€â–º 200 OK â†’ Success
    â”‚           â”‚
    â”‚           â”œâ”€â–º 400 Bad Request
    â”‚           â”‚     â””â”€â–º Show validation error
    â”‚           â”‚         â””â”€â–º User corrects input
    â”‚           â”‚
    â”‚           â”œâ”€â–º 401 Unauthorized
    â”‚           â”‚     â””â”€â–º Clear token
    â”‚           â”‚         â””â”€â–º Redirect to login
    â”‚           â”‚
    â”‚           â”œâ”€â–º 403 Forbidden
    â”‚           â”‚     â””â”€â–º Show "Email not verified"
    â”‚           â”‚         â””â”€â–º Offer resend option
    â”‚           â”‚
    â”‚           â”œâ”€â–º 404 Not Found
    â”‚           â”‚     â””â”€â–º Show "User not found"
    â”‚           â”‚
    â”‚           â””â”€â–º 500 Server Error
    â”‚                 â””â”€â–º Show "Something went wrong"
    â”‚                     â””â”€â–º Contact support
    â”‚
    â””â”€â–º All Errors
          â””â”€â–º Toast Notification
              â””â”€â–º User sees friendly message
```

---

These diagrams provide a visual representation of how the DropIt registration system works. Use them as a reference when:
- Understanding the system architecture
- Debugging issues
- Explaining the system to others
- Planning new features
- Onboarding new developers

ğŸšš **DropIt - Deliver trust. On-chain.**
